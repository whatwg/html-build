language: bash
services:
  - docker

script:
  # Shellcheck
  - shellcheck *.sh
  - shellcheck ci-build/*.sh

  # Build the Docker container, tagged as whatwg/html-build
  - bash ci-build/docker-build.sh

  # Test the Docker container
  - git clone https://github.com/whatwg/html.git --depth 2
  - mkdir output
  - bash ci-build/docker-run.sh html output

  # Tag and publish the Docker container
  - docker tag whatwg/html-build "whatwg/html-build:$(git rev-list --count HEAD)"
  - docker tag whatwg/html-build whatwg/html-build:latest
  - if [[ "$TRAVIS_PULL_REQUEST" = "false" ]]; then docker login --username "$DOCKER_USERNAME" --password "$DOCKER_PASSWORD"; fi
  - if [[ "$TRAVIS_PULL_REQUEST" = "false" ]]; then docker push whatwg/html-build; fi

branches:
  only:
    - master

notifications:
  email:
    on_success: never
    on_failure: always
